async function playAudio(video) {
    console.log('Playing:', video);

    // Remove old highlight
    if (currentVideoId) {
        const oldElement = document.getElementById(`video-${currentVideoId}`);
        if (oldElement) oldElement.classList.remove('playing');
    }

    // Add new highlight
    currentVideoId = video.id;
    const newElement = document.getElementById(`video-${currentVideoId}`);
    if (newElement) newElement.classList.add('playing');

    // Show player
    const playerDiv = document.getElementById('player');
    playerDiv.classList.add('active');
    document.getElementById('nowPlaying').textContent = `üéµ ƒêang ph√°t: ${video.title}`;

    // Play audio
    const audioPlayer = document.getElementById('audioPlayer');
    const streamUrl = `/stream?video_id=${video.id}`;
    
    console.log('Stream URL:', streamUrl);
    
    // Stop current playback
    audioPlayer.pause();
    audioPlayer.src = '';
    
    // Set new source with timestamp to avoid caching
    audioPlayer.src = streamUrl + '&t=' + Date.now();
    audioPlayer.load();
    
    // Add error handler
    audioPlayer.onerror = function(e) {
        console.error('Audio error:', e);
        console.error('Error code:', audioPlayer.error?.code);
        console.error('Error message:', audioPlayer.error?.message);
        showError('Kh√¥ng th·ªÉ ph√°t nh·∫°c. Vui l√≤ng th·ª≠ video kh√°c.');
    };
    
    // Add loaded handler
    audioPlayer.onloadeddata = function() {
        console.log('‚úÖ Audio loaded successfully');
    };
    
    try {
        await audioPlayer.play();
        console.log('‚úÖ Playback started successfully');
    } catch (error) {
        console.error('‚ùå Play error:', error);
        showError('Kh√¥ng th·ªÉ ph√°t nh·∫°c: ' + error.message);
    }
}
